"use strict";(self.webpackChunkadmin_manual=self.webpackChunkadmin_manual||[]).push([[159],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),h=u(a),m=r,d=h["".concat(s,".").concat(m)]||h[m]||c[m]||o;return a?n.createElement(d,l(l({ref:t},p),{},{components:a})):n.createElement(d,l({ref:t},p))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=a[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},7090:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return p},default:function(){return h}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),l=["components"],i={id:"release-howto",title:"Release Howto",sidebar_label:"Release Howto",slug:"/contribute/release-howto"},s=void 0,u={unversionedId:"contribute/release-howto",id:"contribute/release-howto",isDocsHomePage:!1,title:"Release Howto",description:"In this howto we will explain how can a new release be published step by step.",source:"@site/docs/contribute/release-howto.md",sourceDirName:"contribute",slug:"/contribute/release-howto",permalink:"/admin-manual/docs/contribute/release-howto",editUrl:"https://github.com/agoravoting/admin-manual/edit/master/docs/contribute/release-howto.md",tags:[],version:"current",frontMatter:{id:"release-howto",title:"Release Howto",sidebar_label:"Release Howto",slug:"/contribute/release-howto"},sidebar:"docsSidebar",previous:{title:"Release lifecycle and cadence",permalink:"/admin-manual/docs/contribute/release-lifecycle"}},p=[],c={toc:p};function h(e){var t=e.components,a=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In this howto we will explain how can a new release be published step by step.\nPlease refer to the ",(0,o.kt)("a",{parentName:"p",href:"../contribute/release-lifecycle"},"Release Lifecycle")," document to\nknow more about when to do what type of release."),(0,o.kt)("h1",{id:"setup"},"Setup"),(0,o.kt)("p",null,"Releases are managed using the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/agoravoting/agora-release"},"agora-release project"),". Each\nrepository can be released independently."),(0,o.kt)("p",null,"Please install and setup agora-release as described in the repository's\nREADME file."),(0,o.kt)("h1",{id:"release-commands"},"Release commands"),(0,o.kt)("p",null,"Publishing a release is actually compromised of multiple (and sometimes\noptional) steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Changing the version in the code")),(0,o.kt)("p",null,"The code of the software platform itself usually has some reference to the\nrelease. As we are creating a new release, this code needs to be updated."),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Creating a release branch")),(0,o.kt)("p",null,"For example ",(0,o.kt)("inlineCode",{parentName:"p"},"4.0.x")," branch, so that other patch releases fork from there.\nThis branch needs to be created locally and pushed to the public repository."),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Creating a release git tag")),(0,o.kt)("p",null,"Creating the git tag and pushing it to the repository."),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Publishing a github release.")),(0,o.kt)("p",null,"We can do all this in one go with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'./release.py \\\n    --version 4.0.0-beta.1 \\\n    --change-version \\\n    --base-branch master \\\n    --create-branch 4.0.x \\\n    --create-tag \\\n    --release-title "4.0.0-beta.1 release" \\\n    --generate-release-notes \\\n    --prerelease \\\n    --create-release \\\n    --path ../agora-gui-elections\n')),(0,o.kt)("p",null,"Also note that the ",(0,o.kt)("inlineCode",{parentName:"p"},"release.py")," script in this configuration will:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Stash your current changes in the ",(0,o.kt)("inlineCode",{parentName:"li"},"agora-gui-elections")," repository"),(0,o.kt)("li",{parentName:"ul"},"Remove all untracked files and directories (except those ignored by ",(0,o.kt)("inlineCode",{parentName:"li"},".gitignore"),")"),(0,o.kt)("li",{parentName:"ul"},"Create a branch from origin/master, commit the changes and force push it to\nthe origin"),(0,o.kt)("li",{parentName:"ul"},"Create tag from the just created commit and force push it to the origin"),(0,o.kt)("li",{parentName:"ul"},"Create a release from the just created tag")),(0,o.kt)("p",null,"If you are releasing in an existing branch for a minor release, the command\nwould probably be more similar to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./release.py \\\n    --version 4.0.0-beta.2 \\\n    --change-version \\\n    --base-branch 4.0.x \\\n    --push-current-branch \\\n    --create-tag \\\n    --release-title \"4.0.0-beta.2 release\" \\\n    --previous-tag-name '4.0.0-beta.1' \\\n    --generate-release-notes \\\n    --prerelease \\\n    --create-release \\\n    --path ../agora-gui-elections\n")),(0,o.kt)("p",null,"Note that here:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"We are not creating the ",(0,o.kt)("inlineCode",{parentName:"li"},"4.0.x"),"  branch, because it already exists. Instead,\nwe are pushing current branch (4.0.x, set with ",(0,o.kt)("inlineCode",{parentName:"li"},"--base-branch 4.0.x"),")."),(0,o.kt)("li",{parentName:"ul"},"We are specifying ",(0,o.kt)("inlineCode",{parentName:"li"},"--previous-tag-name '4.0.0-beta.1'"),", because otherwise the\ngithub-generated release notes would use the most recent release as a base, and\nthat might not be what we want as the previous release might have been for\na different major version.")),(0,o.kt)("p",null,"To do a full plataform release, these are all the projects that need to be\nreleased using the previous command:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"agora-gui-common"),(0,o.kt)("li",{parentName:"ul"},"agora-gui-admin"),(0,o.kt)("li",{parentName:"ul"},"agora-gui-elections"),(0,o.kt)("li",{parentName:"ul"},"agora-gui-booth"),(0,o.kt)("li",{parentName:"ul"},"agora_elections"),(0,o.kt)("li",{parentName:"ul"},"agora-dev-box"),(0,o.kt)("li",{parentName:"ul"},"agora-tally"),(0,o.kt)("li",{parentName:"ul"},"agora-results"),(0,o.kt)("li",{parentName:"ul"},"agora-verifier"),(0,o.kt)("li",{parentName:"ul"},"frestq"),(0,o.kt)("li",{parentName:"ul"},"election-orchestra"),(0,o.kt)("li",{parentName:"ul"},"authapi"),(0,o.kt)("li",{parentName:"ul"},"agora-tools"),(0,o.kt)("li",{parentName:"ul"},"vfork"),(0,o.kt)("li",{parentName:"ul"},"admin-manual"),(0,o.kt)("li",{parentName:"ul"},"agora-release")),(0,o.kt)("p",null,"Note that the order listed above is important for automatic unit tests. For\nexample, ",(0,o.kt)("inlineCode",{parentName:"p"},"agora-verifier")," uses ",(0,o.kt)("inlineCode",{parentName:"p"},"agora-results"),", which in turn depends on\n",(0,o.kt)("inlineCode",{parentName:"p"},"agora-tally"),". Please do the releasing in order. If you don't, you'll get some\ngithub actions failed. If this happens, just rerun the github actions after all\nthe releases have been done and that should fix the problem."),(0,o.kt)("h1",{id:"release-testing-and-version-schedule"},"Release Testing and version schedule"),(0,o.kt)("p",null,"For any major release, first a ",(0,o.kt)("inlineCode",{parentName:"p"},"<major>.<minor>.<patch>-beta.1")," should be created.\nAfter this has been done for the whole platform, automatic unit testing\nshould work. Also, manual testing (for those tests that are not yet\nautomated) should be performed, and enough time for doing the manual testing\n","[TBD]"," and bug fixing should be allocated."),(0,o.kt)("p",null,"After this bugfixing, either a new beta or a final release should be created,\nwith all the bugfixes being applied in the release branch which should be\ncalled ",(0,o.kt)("inlineCode",{parentName:"p"},"<major>.<minor>.x"),". This should happen after 7 or more days after the\ninitial beta. A second beta (or even a third one and so on) can happen if the\nprevious beta release was not deemed to be stable enough even after some\nbugfixes have been applied."),(0,o.kt)("p",null,"Also, even if no bugfix is applied, a new final (with ",(0,o.kt)("inlineCode",{parentName:"p"},"--prerelease"),") release\nshould be created, named ",(0,o.kt)("inlineCode",{parentName:"p"},"<major>.<minor>.0"),", with patch version ",(0,o.kt)("inlineCode",{parentName:"p"},"0"),". "),(0,o.kt)("h1",{id:"future"},"Future"),(0,o.kt)("p",null,"In the future, we should automate the release management command and include\nthem within each different project instead of having a separate repository to\nhandle this."),(0,o.kt)("p",null,"Some tools we might take a look at to do so:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/marketplace/actions/automatic-releases"},"https://github.com/marketplace/actions/automatic-releases"))),(0,o.kt)("p",null,"Also we should automate the releases for the admin-manual itself, allowing\nhaving multiple version of the documentation, to match with the releases."))}h.isMDXComponent=!0}}]);