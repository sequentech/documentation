(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{111:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/deployment-skel-cc75d97a27c7c6e3e294b46abcea2d64.yml"},132:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/tmux.conf-1ea944c595a2e9828fd022867ac9a3ce.yml"},133:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/files/config.master-4a5303e2713f8a14768318ee03684874.yml"},74:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),r=(n(0),n(88)),i={id:"guide",title:"Deployment Guide",sidebar_label:"Deployment Guide",slug:"/deployment/guide"},s={unversionedId:"deployment/guide",id:"deployment/guide",isDocsHomePage:!1,title:"Deployment Guide",description:"This document describes the complete deployment of an Agora Voting project",source:"@site/docs/deployment/guide.md",slug:"/deployment/guide",permalink:"/admin-manual/docs/deployment/guide",editUrl:"https://github.com/agoravoting/admin-manual/edit/master/docs/deployment/guide.md",version:"current",sidebar_label:"Deployment Guide",sidebar:"docsSidebar",next:{title:"Deployment Troubleshooting",permalink:"/admin-manual/docs/deployment/troubleshooting"}},l=[{value:"Requirements",id:"requirements",children:[]},{value:"Ops environment",id:"ops-environment",children:[{value:"Configuring access to each VM inside the ops machine",id:"configuring-access-to-each-vm-inside-the-ops-machine",children:[]},{value:"Configuring ops hosts",id:"configuring-ops-hosts",children:[]},{value:"Collaborate sharing with tmuxinator",id:"collaborate-sharing-with-tmuxinator",children:[]},{value:"Creating the mux project",id:"creating-the-mux-project",children:[]}]},{value:"For each machine",id:"for-each-machine",children:[{value:"Machine provisioning",id:"machine-provisioning",children:[]},{value:"Machine configuration",id:"machine-configuration",children:[]},{value:"Network, firewall &amp; DNS",id:"network-firewall--dns",children:[]},{value:"Backups",id:"backups",children:[]},{value:"Non-root permissions (optional)",id:"non-root-permissions-optional",children:[]},{value:"Install and configure deployment dependencies",id:"install-and-configure-deployment-dependencies",children:[]}]},{value:"Web servers master &amp; slave deployment",id:"web-servers-master--slave-deployment",children:[{value:"Configure the slave",id:"configure-the-slave",children:[]}]},{value:"Deployment of authorities",id:"deployment-of-authorities",children:[{value:"Connecting authorities",id:"connecting-authorities",children:[]},{value:"Test the connection between the authorities",id:"test-the-connection-between-the-authorities",children:[]},{value:"Connecting web servers with authorities",id:"connecting-web-servers-with-authorities",children:[]},{value:"Create a test election",id:"create-a-test-election",children:[]},{value:"Check high availability and load balancing",id:"check-high-availability-and-load-balancing",children:[]},{value:"Test changing a slave to be a master and do a tally",id:"test-changing-a-slave-to-be-a-master-and-do-a-tally",children:[]}]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],c={toc:l};function p(e){var t=e.components,i=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,i,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This document describes the complete deployment of an Agora Voting project\nwith two Authorities for a production environment in virtual machines."),Object(r.b)("h2",{id:"requirements"},"Requirements"),Object(r.b)("p",null,"You need 4 Linux x64 host machines with at least 4GB of RAM each and a clean\nUbuntu 20.04 LTS installed and around 30GB of HD."),Object(r.b)("p",null,"The structure of the four machines is:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"prod-s1\nused as master web server")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"prod-s2\nused as slave web server")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"prod-a1\nused as election authority 1")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"prod-a2\nused as election authority 2"))),Object(r.b)("p",null,"The instructions in the requirements section should be executed in all 4\nmachines. We asume that either:"),Object(r.b)("p",null,"a. A fith machine can be used as the load balancer and for high availability\npurposes and act as the public interface to the Internet. This is not a\nrequirement, you can just point the DNS to the master and change it manually\nif it fails, but then only the master will be serving requests. The load\nbalancer can be provided by the cloud provided if you use one. We do not have\nany ansible deployment script to configure the load balancer."),Object(r.b)("p",null,"b. Otherwise, prod-s1 will be used as the public interface interface to the\nInternet unless it fails, then prod-s2 will be used for continuing operations."),Object(r.b)("h2",{id:"ops-environment"},"Ops environment"),Object(r.b)("p",null,"It\u2019s recommended to minimize the number of publicly reachable machines to\nminimize attack surface. That\u2019s why other than the publicly serving machines like load\nbalances and such, all the communications should be done through an internal\nnetwork unreachable through the Internet."),Object(r.b)("p",null,"To reach to this internal network, we suggest to use an ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine as a\nsingle point of access for increased security and simplicity. For example, in\nour case as we usually use Amazon Web Services EC2, our ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine is called\n",Object(r.b)("inlineCode",{parentName:"p"},"aws-ops"),". This machine allows us to access all the other ones via ssh."),Object(r.b)("p",null,"If you are using vagrant for local development, your ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine might just\nbe the physical host."),Object(r.b)("p",null,"WARNING: Currently the vagrant configuration is outdated and needs changes to\nwork."),Object(r.b)("p",null,"Some other recommendations to minimize attack surface:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Use wisely security groups: only open ports to the Internet if you really\nneed to."),Object(r.b)("li",{parentName:"ul"},"Do not setup a public ip address to a machine if it can keep being private.\nAll machines should only be accessible through ssh via the ",Object(r.b)("inlineCode",{parentName:"li"},"ops")," machine,\nwith the root@aws-ops user and to the root user of the destination machine.")),Object(r.b)("h3",{id:"configuring-access-to-each-vm-inside-the-ops-machine"},"Configuring access to each VM inside the ops machine"),Object(r.b)("p",null,"Each machine should have its own static private ip address inside the private\nnetwork and its own name. This should be configured in the ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine to\naccess them by name."),Object(r.b)("p",null,"By default, ssh access to this deployment machines is done through the ",Object(r.b)("inlineCode",{parentName:"p"},"ubuntu"),"\nuser, and only from that you can ",Object(r.b)("inlineCode",{parentName:"p"},"sudo -s")," to root or other users. In order for\nnot to need to specify this user everytime you login and for every new machine,\nwe suggest you add the following two lines to the ",Object(r.b)("inlineCode",{parentName:"p"},"/root/.ssh/config")," file:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"Host *\nUser ubuntu\n")),Object(r.b)("h3",{id:"configuring-ops-hosts"},"Configuring ops hosts"),Object(r.b)("p",null,"For each machine, you will need to add a line in ",Object(r.b)("inlineCode",{parentName:"p"},"/etc/hosts")," in the ",Object(r.b)("inlineCode",{parentName:"p"},"ops"),"\nmachine, for example  ",Object(r.b)("inlineCode",{parentName:"p"},"192.168.1.2 prod-s1"),"."),Object(r.b)("p",null,"In case of using vagrant for local deployment, this won't be needed as it's\nalready configured by vagrant."),Object(r.b)("h3",{id:"collaborate-sharing-with-tmuxinator"},"Collaborate sharing with tmuxinator"),Object(r.b)("p",null,"To help collaboration during operations among employees and to ease operations\nand monitorization of a deployment, we recommend to execute everything under a\nsingle shared ",Object(r.b)("inlineCode",{parentName:"p"},"tmux")," session per deployment in the ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine. "),Object(r.b)("p",null,"We use ",Object(r.b)("inlineCode",{parentName:"p"},"tmuxinator")," to help managing these ",Object(r.b)("inlineCode",{parentName:"p"},"tmux")," sessions. Please install it\nin the ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine in the root user."),Object(r.b)("p",null,"You can access our base skeleton configuration for a deployment in the\n",Object(r.b)("a",{target:"_blank",href:n(111).default},"deployment-skel.yml")," file. You can:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Install ",Object(r.b)("inlineCode",{parentName:"li"},"tmux")," and ",Object(r.b)("inlineCode",{parentName:"li"},"tmuxinator")," in the ",Object(r.b)("inlineCode",{parentName:"li"},"ops")," machine:")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"apt install tmux tmuxinator -y\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Add an ",Object(r.b)("inlineCode",{parentName:"li"},"mux")," alias to your ",Object(r.b)("inlineCode",{parentName:"li"},"/root/.bashrc"),": ")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"echo \"alias mux='tmuxinator'\" >> /root/.bashrc\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Create the base tmuxinator config file that you'll copy for each deployment\nby copying the file ",Object(r.b)("a",{target:"_blank",href:n(111).default},"deployment-skel.yml")," into the\nfile ",Object(r.b)("inlineCode",{parentName:"p"},"/root/.tmuxinator/deployment-skel.yml")," of the ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine, and also the\nfile ",Object(r.b)("a",{target:"_blank",href:n(132).default},".tmux.conf")," into ",Object(r.b)("inlineCode",{parentName:"p"},"/root/.tmux.conf")," of the ",Object(r.b)("inlineCode",{parentName:"p"},"ops"),"\nmachine.")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Learn the basic tmuxinator & tmux commands:"))),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"mux list"),": List the available projects"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"mux copy deployment-skel prod"),": Copy the deployment-skel to create a ",Object(r.b)("inlineCode",{parentName:"li"},"prod"),"\nproject. This commands directly enters into your configured editor, to edit\nthe project before creating it. If you are using the base skel we mentioned\nearlier and you are using vim as the editor, you can easily just do a quick\nfind & replace all with the command: ",Object(r.b)("inlineCode",{parentName:"li"},":%s/BASE/prod/g")," or similar."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"mux prod"),": Attaches to the ",Object(r.b)("inlineCode",{parentName:"li"},"prod")," project session, starting it first if it\nwasn't started."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"mux del prod"),": Removes the prod project."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"mux stop prod"),": Stops the prod project session."),Object(r.b)("li",{parentName:"ul"},"Ctrl+a, d: Once in a session, detaches from this session."),Object(r.b)("li",{parentName:"ul"},"Ctrl+a, c: Adds a new tab terminal to the current session."),Object(r.b)("li",{parentName:"ul"},"Ctrl+Left/Right arrow: moves from one tab terminal to the other.")),Object(r.b)("h3",{id:"creating-the-mux-project"},"Creating the mux project"),Object(r.b)("p",null,"Each deployment is compromised of multiple machines. As mentioned earlier, we\nrecommend to create a tmuxinator project for each deployment."),Object(r.b)("p",null,"Use ",Object(r.b)("inlineCode",{parentName:"p"},"mux copy deployment-skel <deployment-name>"),": Copy the deployment-skel to\ncreate a ",Object(r.b)("inlineCode",{parentName:"p"},"<deployment-name>")," project. Do a quick find & replace all in vim\ninside the file with the command: ",Object(r.b)("inlineCode",{parentName:"p"},":%s/BASE/<deployment-name>/g")," then save and\nexit with ",Object(r.b)("inlineCode",{parentName:"p"},":wq"),"."),Object(r.b)("h2",{id:"for-each-machine"},"For each machine"),Object(r.b)("p",null,"Refer to this section for the configuration steps you need to take into account\nand execute for each of the machines in the deployment (agora master, slave,\nauth1, auth2..)."),Object(r.b)("h3",{id:"machine-provisioning"},"Machine provisioning"),Object(r.b)("p",null,"As mentioned earlier, you should provision each VM with Ubuntu 16.04 LTS,\n4GB of RAM and usually around 30GB HD. The machine requirements might\nvary depending on the size and number of the elections that these machines will\nbe used for."),Object(r.b)("p",null,"For a faster deployment we recommend to increase the number of cores. This can\nbe reduced later to even just 1 core and 2GB of RAM."),Object(r.b)("p",null,"In AWS EC2 we usually use the free ",Object(r.b)("inlineCode",{parentName:"p"},"Ubuntu 20.04 LTS - Focal")," AWS Marketplace\nAMI provided by ",Object(r.b)("inlineCode",{parentName:"p"},"Canonical Group Limited"),". If you are using vagrant, it will\ntake care of the provisioning of the VMs."),Object(r.b)("p",null,"It's customary for us to name each machine by the hostname it will use. For\nexample in AWS EC2 an instance whose hostname is ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1")," (trustee #1 for the\nproduction deployment) would be called ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1"),". Also, the name of the related\nvolume (the hard disk) would have the same name."),Object(r.b)("h3",{id:"machine-configuration"},"Machine configuration"),Object(r.b)("p",null,"Once the machines are provisioned, we should configure them individually. The\nansible deployment script is typically executed within the deployed machine.\nThis allows us to have different deployments with different ansible versions\nall reachable through the ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," machine."),Object(r.b)("h3",{id:"network-firewall--dns"},"Network, firewall & DNS"),Object(r.b)("p",null,"We use static private (and public) ip addresses. All the machines in the\ndeployment should be able to see each other and be reachable via the ",Object(r.b)("inlineCode",{parentName:"p"},"ops"),"\nmachine."),Object(r.b)("p",null,"To do that, for example in AWS we assign a security group called ",Object(r.b)("inlineCode",{parentName:"p"},"internal"),"\nthat has the following rule:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Type: All traffic"),Object(r.b)("li",{parentName:"ul"},"Protocol: All"),Object(r.b)("li",{parentName:"ul"},"Port range: All"),Object(r.b)("li",{parentName:"ul"},"Source: 172.31.0.0/16")),Object(r.b)("p",null,"Firewall rules should be created to allow the following kind of connections:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"postgresql:")," prod-s1 ",Object(r.b)("strong",{parentName:"li"},"<<tcp:5432>>")," prod-s2"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"postgresql's rsync:")," prod-s1 ",Object(r.b)("strong",{parentName:"li"},"<<tcp:22>>")," prod-s2"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"web site:")," ","[prod-s1, prod-s2]"," ",Object(r.b)("strong",{parentName:"li"},"<<tcp:443>>")," Internet"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"sentry api:")," ","[prod-s1, prod-s2]"," ",Object(r.b)("strong",{parentName:"li"},"<<tcp:9090>>")," Internet"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"sentry web site:")," ","[prod-s1, prod-s2]"," ",Object(r.b)("strong",{parentName:"li"},"<<tcp:8443>>")," Internet"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"eotest:")," prod-a1 ",Object(r.b)("strong",{parentName:"li"},"<<tcp:5000>>")," prod-a2"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"mixnet:")," prod-a1 ",Object(r.b)("strong",{parentName:"li"},"<<tcp:4081>>")," prod-a2"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"mixnet:")," prod-a1 ",Object(r.b)("strong",{parentName:"li"},"<<udp:8081>>")," prod-a2"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"private ballots download:")," ","[prod-s1, prod-s2]"," ",Object(r.b)("strong",{parentName:"li"},"<<tcp:14453>>")," ","[prod-a1, prod-a2]")),Object(r.b)("p",null,"You can create the appropiate rules to allow this access to the different\nservices. For example if one or more of the trustee machines are external,\nyou will have to open the appropiate ports so that they can communicate with\nthe ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s1")," and ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s2")," machines and with the trustee machines in the\ninternal network."),Object(r.b)("p",null,"We also typically configure the public access to the servers through cloudflare.\nTo make it work, you need to give public access to the 80,443 and 8443 ports\nto ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.cloudflare.com/ips/"}),"cloudflare ips"),". In AWS we use a\n",Object(r.b)("inlineCode",{parentName:"p"},"cloudflare")," security group for that and apply it either to the master machine\n(",Object(r.b)("inlineCode",{parentName:"p"},"prod-s1"),") or to the load balancer, and then assign a Public Static IP\naddress for that machine and point to that IP Address in Cloudflare's DNS."),Object(r.b)("h3",{id:"backups"},"Backups"),Object(r.b)("p",null,"In AWS EC2 we use ",Object(r.b)("inlineCode",{parentName:"p"},"AWS Backup")," to automate backups. They are done at the VM\nlevel and they can be easily created by simply assigning a tag to the Volumnes\nof the VMs."),Object(r.b)("p",null,"AWS Backup creates and manages (also deleting old ones) snapshots of volumes.\nBTW we usually configure the instances to be encrypted, and thus snasphots are\nalso encrypted. "),Object(r.b)("p",null,"We usually have a backup plan in ",Object(r.b)("inlineCode",{parentName:"p"},"AWS Backup")," that is applied to any volume\nwith the ",Object(r.b)("inlineCode",{parentName:"p"},"backup-normal")," tag, with the following configuration:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"1 daily backup, save 6 last."),Object(r.b)("li",{parentName:"ul"},"1 weekly backup, save 4 last."),Object(r.b)("li",{parentName:"ul"},"1 monthly backup, save 24 last."),Object(r.b)("li",{parentName:"ul"},"1 each 3 hours, save 7 last.")),Object(r.b)("p",null,"To restore a backup, you just need to create a volume out of this snapshot in\nthe same Availability Zone as the instance you want to attach it to. "),Object(r.b)("p",null,"We usually do that manually with a name similar to the original volume name, for\nexample it could be ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1-restored-1"),". You could stop the ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1")," instance,\ndetach the ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1")," volume, attach the new ",Object(r.b)("inlineCode",{parentName:"p"},"prod-a1-restored-1")," volume as\n",Object(r.b)("inlineCode",{parentName:"p"},"/dev/sda1"),"."),Object(r.b)("h3",{id:"non-root-permissions-optional"},"Non-root permissions (optional)"),Object(r.b)("p",null,"One can use a non-root use for deployment. Unless a requirement, we don't\nusually do it. Thus, this step is not very well tested lately. Deployment is\ntypically done within the Ubuntu machine as the root user. You can skip this\nstep."),Object(r.b)("p",null,"To configure non-root permissions in the VM, first create the deployment user",Object(r.b)("br",{parentName:"p"}),"\n","if it hasn't been created yet. We'll use ",Object(r.b)("strong",{parentName:"p"},"agora")," for that:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'root@prod-s1 # adduser agora agora --gecos "FullName,RoomNumber,WorkPhone,HomePhone" --disabled-password\n')),Object(r.b)("p",null,"Afterwards, you should add the permissions that the agora user requires for\nadministration and deployment."),Object(r.b)("p",null,"This is how you do it in the two servers that will be used as authorities:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"root@prod-s1 # wget https://raw.githubusercontent.com/agoravoting/agora-dev-box/next/doc/production/auth.sudoers\nroot@prod-s1 # cat auth.sudoers >> /etc/sudoers\n")),Object(r.b)("p",null,"And this is how you do it for the two other servers that will be used as master\nand slave machines:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"root@prod-s1 # wget https://raw.githubusercontent.com/agoravoting/agora-dev-box/next/doc/production/agora.sudoers\nroot@prod-s1 # cat agora.sudoers >> /etc/sudoers\n")),Object(r.b)("h3",{id:"install-and-configure-deployment-dependencies"},"Install and configure deployment dependencies"),Object(r.b)("p",null,"Within the provisioned machine (for example ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s1"),"), there are a series of\nsteps required for a  proper and successful deployment. We will from now on\nassume we are using the root user (",Object(r.b)("inlineCode",{parentName:"p"},"sudo -s"),") inside the provisioned VM to\nexecute all the tasks."),Object(r.b)("p",null,"We will first do some updates, install some dependencies, configure the\ntimezone and reboot:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'ln -sf /usr/share/zoneinfo/Europe/Madrid /etc/localtime\ndpkg-reconfigure -f noninteractive tzdata\necho "source /usr/share/virtualenvwrapper/virtualenvwrapper.sh" >> /root/.bashrc\napt-get update && apt-get dist-upgrade -y && apt install virtualenvwrapper -y  && reboot \n')),Object(r.b)("p",null,"We usually have a copy of the configuration file in ",Object(r.b)("inlineCode",{parentName:"p"},"ops")," then copy it to the\nmachine (we cannot directly ssh to it for security reasons). So we usually have\na generic config file in ops machine. Then from ops, copy it to the provisioned\nmachine, for example in prod-s1:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"scp config-base.yml prod-s1:/home/ubuntu/config.yml\n")),Object(r.b)("p",null,"The previous step is not really required, but it is required for the following\nsteps to have the ",Object(r.b)("inlineCode",{parentName:"p"},"config.yml")," inside the ",Object(r.b)("inlineCode",{parentName:"p"},"/home/ubuntu"),". You can for example\nuse the config file from ",Object(r.b)("a",{target:"_blank",href:n(133).default},"config.master.yml")," as a\nbase, copying it instead."),Object(r.b)("p",null,"Then in the provisioned machine as root, we install dependencies and move the\nconfig file where it needs to be (for example ",Object(r.b)("inlineCode",{parentName:"p"},"/root/prod-s1/root.yml"),"):"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'# change the NAME var to the appropiate name\nexport NAME="prod-s1"\nexport LC_ALL="en_US.UTF-8"\nexport LC_CTYPE="en_US.UTF-8"\nmkvirtualenv ansible -p $(which python3)\ndeactivate\nworkon ansible\n\n# should return Python 3.8.5:\npython --version \ncd /root\ngit clone https://github.com/agoravoting/agora-dev-box.git $NAME\ncd $NAME\ngit checkout master\n\n# needed for ansible. If you are deploying an election authority use\n# doc/production/playbook.auth.yml instead\necho "localhost ansible_connection=local" > inventory \ncp doc/production/playbook.agora.yml playbook.yml\n\n# copy the config file to /root/$NAME/root.yml\ncp /home/ubuntu/config.yml config.yml\n\n# update and set random passwords. NOTE: Do not do that for the slave machines, \n# it needs to be using the same passwords as the master.\nDATE=$(date); cp config.yml "config_base_$DATE.yml"; python3 helper-tools/manage_config_pwd.py -c "config_base_$DATE.yml" -l 40 -o config.yml\n\npip install ansible==2.9.18\n')),Object(r.b)("p",null,"After this, one should edit the config.yml file and edit the appropiate values,\nplease read below about how to do that. "),Object(r.b)("p",null,"For the slave machine (for example ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s2"),") one would copy the config.yml\nfrom ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s1")," and not change the the passwords with the ",Object(r.b)("inlineCode",{parentName:"p"},"manage_config_pwd.py"),"\nscript. "),Object(r.b)("p",null,"Even for the election authorities' machines, it's easiest to just copy the\n",Object(r.b)("inlineCode",{parentName:"p"},"config.yml")," file from ",Object(r.b)("inlineCode",{parentName:"p"},"prod-s1")," and use it as a base. However, we provide\nsample production config files for both agora and auth machines in the\n",Object(r.b)("inlineCode",{parentName:"p"},"doc/production")," directory."),Object(r.b)("h2",{id:"web-servers-master--slave-deployment"},"Web servers master & slave deployment"),Object(r.b)("p",null,"Both machines prod-s1 and prod-s2 should be setup with the same passwords,\nbecause they will be a replica of each other: the slave will be in hot standby\nconfiguration. The only difference between the configuration file of ",Object(r.b)("strong",{parentName:"p"},"prod-s1"),"\nand ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," should be the following config keys:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"config.hostname"),Object(r.b)("li",{parentName:"ul"},"config.public_ipaddress"),Object(r.b)("li",{parentName:"ul"},"config.private_ipaddress"),Object(r.b)("li",{parentName:"ul"},"config.load_balancing.repmgr_node_id")),Object(r.b)("p",null,"Please read the comments and instructions inside the configuration file\nand accordingly. Both machines for deploy purposes should have the\n",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.is_master")," set to ",Object(r.b)("strong",{parentName:"p"},"true")," and The\n",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.master.slave_postgres_ssh_keys")," and\n",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.master.slave_agoraelections_ssh_keys")," set to ",Object(r.b)("strong",{parentName:"p"},"[]"),"\n(which means empty list) at this stage of deployment."),Object(r.b)("p",null,"If your machine is behind a proxy, you need to specify that in the\n",Object(r.b)("strong",{parentName:"p"},"config.has_https_proxy")," variable."),Object(r.b)("p",null,"After setting the configuration, you should set the playbook that we will use\nfor deploying as master the machines, we already configured the inventory for\ndeploying locally. The next step is to deploy with ansible:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"date; time ansible-playbook -i inventory playbook.yml; date\n")),Object(r.b)("p",null,"Once this is done, the initial as-master deployment has been successful."),Object(r.b)("p",null,"If you have assigned a FQDN to for example 'agora.example.com' to the machine\nand the name resolution is set up correctly in your personal machine via DNS or\nby adding 'agora.example.com ipaddr' to your '/etc/hosts', you should be able to login\nas an administrator entering in '",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://agora.example.com/admin/login'"}),"https://agora.example.com/admin/login'")," using\nthe credentials you specified in the config.yml file."),Object(r.b)("p",null,"We recommend to use the /etc/hosts file to change the ip address of the\nwebserver from prod-s1 to prod-s2 ip easily for testing purposes."),Object(r.b)("h3",{id:"configure-the-slave"},"Configure the slave"),Object(r.b)("p",null,"To configure prod-s2 as a slave, we need to import the ssh keys from the\nagoraelections and postgres users in ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"prod-s1"))," to add them in ",Object(r.b)("strong",{parentName:"p"},"*prod-s2"),"."),Object(r.b)("p",null,"To get the keys execute these commands in ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"prod-s2")),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo -u agoraelections cat /home/agoraelections/.ssh/id_rsa.pub\nsudo -u postgres cat /var/lib/postgresql/.ssh/id_rsa.pub\n")),Object(r.b)("p",null,"Copy those keys and set them in the ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," ",Object(r.b)("strong",{parentName:"p"},"config.yml")," file in\nthe variables ",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.master.slave_agoraelections_ssh_keys"),"\nand ",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.master.slave_postgres_ssh_keys"),"."),Object(r.b)("p",null,"Then, execute again ansible in ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("em",{parentName:"strong"},"prod-s1"))," to apply the changes:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"date; time ansible-playbook -i inventory playbook.yml; date\n")),Object(r.b)("p",null,"After that, then you can change the ",Object(r.b)("strong",{parentName:"p"},"config.yml")," for ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," to set\nthe variable ",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.is_master")," to ",Object(r.b)("strong",{parentName:"p"},"false"),",\n",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.slave.master_hostname")," to the hostname of ",Object(r.b)("strong",{parentName:"p"},"prod-s1"),"\nand ",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.repmgr_node_id")," to ",Object(r.b)("strong",{parentName:"p"},"2"),"."),Object(r.b)("p",null,"If your machine is behind a proxy, you need to specify that in the\n",Object(r.b)("strong",{parentName:"p"},"config.has_https_proxy")," variable."),Object(r.b)("p",null,"Then you can run again ansible in ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," to apply the changes, using the\nslave specific playbook, which can only work after having executed\n",Object(r.b)("strong",{parentName:"p"},"playbook.agora.yml"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-s2:/root/prod-s2/ $ cp doc/production/playbook.slave.yml playbook.yml\nroot@prod-s2:/root/prod-s2/ $ time sudo ansible-playbook -i inventory playbook.yml\n")),Object(r.b)("h2",{id:"deployment-of-authorities"},"Deployment of authorities"),Object(r.b)("p",null,"Please follow the steps of the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"#for-each-machine"}),"For Each Machine section")," to\ndo the initial provisioning and configuration of the election authorities,\nprod-a1, prod-a2. Afterwards, continue reading this section."),Object(r.b)("p",null,"We'll use an authority config file as a base:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ cp doc/production/config.auth.yml config.yml\n")),Object(r.b)("p",null,"Edit the config.yml file following the instructions inside. Specifically, don't forget to edit:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"config.hostname"),Object(r.b)("li",{parentName:"ul"},"config.public_ipaddress"),Object(r.b)("li",{parentName:"ul"},"config.private_ipaddress")),Object(r.b)("p",null,"Then deploy as usual:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ date; time ansible-playbook -i inventory playbook.yml; date\n")),Object(r.b)("h3",{id:"connecting-authorities"},"Connecting authorities"),Object(r.b)("p",null,"Authorities communicate with other authorities using ssl and client\ncertificates so the authority server doesn't accept queries from unknown\nservers. In a real election system it's a good idea to not publish the ips\nand ports of the authorities to avoid malicious attacks."),Object(r.b)("p",null,"The deployment script creates a certificate for each authority in\n/srv/cert/selfsigned/ and we manage the authority communication and\ncertificate sharing with the eopeers tool."),Object(r.b)("p",null,"Execute the following in ",Object(r.b)("strong",{parentName:"p"},"prod-a1"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ eopeers --show-mine\n")),Object(r.b)("p",null,"Copy the output to a file in ",Object(r.b)("strong",{parentName:"p"},"prod-a2"),", then install it:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a2:/root/prod-a2/ $ eopeers --install prod-a1.pkg\nroot@prod-a2:/root/prod-a2/ $ service nginx restart\n")),Object(r.b)("p",null,"Then do the same the other way around:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ eopeers --show-mine\nroot@prod-a1:/root/prod-a1/ $ eopeers --install prod-a2.pkg\nroot@prod-a1:/root/prod-a1/ $ service nginx restart\n")),Object(r.b)("h3",{id:"test-the-connection-between-the-authorities"},"Test the connection between the authorities"),Object(r.b)("p",null,"A tool is installed to test the real connection between the authorities.\nOpen two terminal windows.  Open ",Object(r.b)("inlineCode",{parentName:"p"},"eolog")," in one of the terminal windows:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ sudo eolog\n")),Object(r.b)("p",null,"Run eotest in the other terminal window from the other auth server:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ eotest full --vmnd --vcount 100\n")),Object(r.b)("p",null,"You should see the software working as eolog output will appear in the\nfirst terminal window. Once it the eotest command finishes, you can also close\nprod-a2 connection to eolog. Congratulations, you have run a complete test\nbetween the two authorities in which:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Create:")," Election public and private keys have been created."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Encrypt:")," Test ballots have been created and encrypted."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Tally:")," Those encrypted votes have been mixed and decrypted.")),Object(r.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The ",Object(r.b)("inlineCode",{parentName:"p"},"eotest")," command is useful to test election authorities. You can change the\nnumber of votes to use in the test using the ",Object(r.b)("inlineCode",{parentName:"p"},"--vcount"),"  option. In our example\nabove we used 100 votes, but you could tally 100,000 or any other number. This\ncan help you find out how much time the tally would take and if the authority\nmachine configuration and hardware would work with a specific number of votes."),Object(r.b)("p",{parentName:"div"},"By default eotest uses all connected authorities, but you can also specify with\nwhich other authorities you want to do the test using the ",Object(r.b)("inlineCode",{parentName:"p"},"--peers")," option.\nYou can execute each of the steps individually using ",Object(r.b)("inlineCode",{parentName:"p"},"create"),", ",Object(r.b)("inlineCode",{parentName:"p"},"encrypt")," or\n",Object(r.b)("inlineCode",{parentName:"p"},"tally")," options instead of ",Object(r.b)("inlineCode",{parentName:"p"},"full"),". Find more information with ",Object(r.b)("inlineCode",{parentName:"p"},"eotest --help"),"."))),Object(r.b)("h3",{id:"connecting-web-servers-with-authorities"},"Connecting web servers with authorities"),Object(r.b)("p",null,"The following commands should be executed in both ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," and ",Object(r.b)("strong",{parentName:"p"},"prod-s2"),"\nmachines:"),Object(r.b)("p",null,"Create ",Object(r.b)("strong",{parentName:"p"},"prod-a1.pkg")," and ",Object(r.b)("strong",{parentName:"p"},"prod-a2.pkg")," files with the configuration of both\nauthorities. Then install them:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-s1:/root/prod-s1/ $ eopeers --install prod-a1.pkg --keystore /home/agoraelections/keystore.jks\nroot@prod-s1:/root/prod-s1/ $ eopeers --install prod-a2.pkg\nroot@prod-s1:/root/prod-s1/ $ service nginx restart\n")),Object(r.b)("p",null,"Before completion, the installation of the certificate of the ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," and\n",Object(r.b)("strong",{parentName:"p"},"prod-s2"),' servers needs to be installed in the election authorities, because\neven though i\'ts the same TLS cert, they have different hostnames. So copy\nthem (get it with "eopeers --show-mine") to the authorities and install them:'),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-a1:/root/prod-a1/ $ eopeers --install prod-s1.pkg\nroot@prod-a1:/root/prod-a1/ $ eopeers --install prod-s2.pkg\nroot@prod-a1:/root/prod-a1/ $ service nginx restart\n")),Object(r.b)("h3",{id:"create-a-test-election"},"Create a test election"),Object(r.b)("p",null,"Go to https://prod-s1/admin/login and create a test election. Then execute\nthe following to create some votes. Change '2' in the following commands with\nyour election number:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-s1:/root/prod-s1/ $ su - agoraelections\nagoraelections@prod-s1:~ $ source ~/env/bin/activate\nagoraelections@prod-s1:~ $ cd ~/agora-elections/admin\nagoraelections@prod-s1:~ $ export ELECTION_ID=2\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py dump_pks $ELECTION_ID\nagoraelections@prod-s1:~/agora-elections/admin/ $ echo '[1,0]' > votes.json\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py encrypt $ELECTION_ID\n")),Object(r.b)("p",null,"start the election, cast the votes, stop it and tally it:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'agoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py start $ELECTION_ID\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py cast_votes $ELECTION_ID\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py count_votes $ELECTION_ID \n# it will output: "2 (2)" which means 2 votes cast, 2 unique voters\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py stop $ELECTION_ID\nagoraelections@prod-s1:~/agora-elections/admin/ $ ./admin.py tally $ELECTION_ID\n')),Object(r.b)("h3",{id:"check-high-availability-and-load-balancing"},"Check high availability and load balancing"),Object(r.b)("p",null,"The high availability configuration in this configuration basically means that\n",Object(r.b)("strong",{parentName:"p"},"prod-s2")," is a server that is replicating in a hot standby mode the database of\n",Object(r.b)("strong",{parentName:"p"},"prod-s1"),". ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," has also replicated everything needed to be able to\nchange the server from slave to master at any time."),Object(r.b)("p",null,"To test that ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," is correctly deployed as a slave, you can directly\nconnect to https://prod-s2/admin/login and it should allow you to access and work\nnormally, because ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," is a slave that also works as a web server\n(authapi, agora-elections) connected directly to the ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," master database\nserver."),Object(r.b)("p",null,"If you list the files inside the datastore and the server certificate in\nboth ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," and ",Object(r.b)("strong",{parentName:"p"},"prod-s2"),", it should list the same files:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"root@prod-s1:/root/prod-s1/ $ sudo -u agoraelections find /home/agoraelections/datastore/ -type f | xargs md5sum\n05b76ec89dd7a32b76427d389a5778c1  /home/agoraelections/datastore/public/2/pks\n\nroot@prod-s1:/root/prod-s1/ $ find /srv/certs/selfsigned/ -type f | xargs md5sum\nd811c3e92162ade25f21f1d782f32c6e  /srv/certs/selfsigned/calist\n54a67dfe2a9fde364a833135d9bfdd3b  /srv/certs/selfsigned/key-nopass.pem\na9bf327511b67100c096aebed5b46c94  /srv/certs/selfsigned/cert.pem\n")),Object(r.b)("h3",{id:"test-changing-a-slave-to-be-a-master-and-do-a-tally"},"Test changing a slave to be a master and do a tally"),Object(r.b)("p",null,"This requires to create an election in ",Object(r.b)("strong",{parentName:"p"},"prod-s1")," and cast some votes, then\nlaunch the tally successfully from within the authorities."),Object(r.b)("p",null,"To promote ",Object(r.b)("strong",{parentName:"p"},"prod-s2")," to be a master, change set to ",Object(r.b)("strong",{parentName:"p"},"true")," the config.yml\nconfig variable ",Object(r.b)("strong",{parentName:"p"},"config.load_balancing.is_master"),", then execute again ansible:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"date; time ansible-playbook -i inventory playbook.yml; date\n")),Object(r.b)("p",null,'To be able to receive successfully the tally, prod-s2 needs to "impersonate"\nprod-s1 in the director election authority. This can be done by:'),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"removing the prod-s1 eopeer package:")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"agora@prod-a1:~ $ sudo eopeers --remove prod-s1\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"adding an alias to /etc/hosts in ",Object(r.b)("strong",{parentName:"li"},"prod-a1")," config.yml variable ",Object(r.b)("strong",{parentName:"li"},"config.hosts"),",\nsetting it to something like:")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"hosts:\n- hostname: prod-s1\n  ip: 192.168.50.14\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"re-executing ansible in ",Object(r.b)("strong",{parentName:"li"},"prod-a1"),":")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"date; time ansible-playbook -i inventory playbook.yml; date\n")),Object(r.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(r.b)("p",null,"For troubleshooting please read the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"./troubleshooting"}),"Deployment Troubleshooting"),"."))}p.isMDXComponent=!0},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=o.a.createContext({}),p=function(e){var t=o.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=p(e.components);return o.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),b=p(n),u=a,h=b["".concat(i,".").concat(u)]||b[u]||d[u]||r;return n?o.a.createElement(h,s(s({ref:t},c),{},{components:n})):o.a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);