<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Deployment Troubleshooting | admin-manual</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deployment Troubleshooting | admin-manual"><meta data-react-helmet="true" name="description" content="Problems when creating the election"><meta data-react-helmet="true" property="og:description" content="Problems when creating the election"><link data-react-helmet="true" rel="shortcut icon" href="/admin-manual/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting" hreflang="x-default"><link rel="stylesheet" href="/admin-manual/assets/css/styles.c36e509a.css">
<link rel="preload" href="/admin-manual/assets/js/runtime~main.50757806.js" as="script">
<link rel="preload" href="/admin-manual/assets/js/main.56a78266.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/admin-manual/"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Admin Manual</b></a><a class="navbar__item navbar__link navbar__link--active" href="/admin-manual/docs/deployment/guide">Docs</a><a class="navbar__item navbar__link" href="/admin-manual/docs/file-formats/introduction">File Formats</a></div><div class="navbar__items navbar__items--right"><a href="https://nvotes.com/blog/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/agoravoting/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://nvotes.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Powered By nVotes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Deployment</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/admin-manual/docs/deployment/guide">Deployment Guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/admin-manual/docs/deployment/troubleshooting">Deployment Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/admin-manual/docs/deployment/browsers-and-cookies">Browsers and Cookies</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Translation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Election Testing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced Elections</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integrations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Deployment Troubleshooting</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="problems-when-creating-the-election"></a>Problems when creating the election<a class="hash-link" href="#problems-when-creating-the-election" title="Direct link to heading">#</a></h2><p>This is usually a problem with election authorities. Unfortunately, most of the
issues related to election authorities do not get reported to the user nor the
superadmins, although it&#x27;s also true that most of these issues are solved when
doing the deployment.</p><p>To debug and analyze the situation, you can use the following commands in the
election authorities or the agora server:</p><ol><li><p>See if the requests are reaching to nginx reading its log:</p><p>$ sudo tail -f /var/log/nginx/access.log</p></li></ol><p>nginx is in charge of filtering and accepting only https requests from http
clients (i.e. other &quot;eopeers&quot; or &quot;agora&quot; servers) whose client tls certificate
is installed in the peer.</p><p>If requests are being received but rejected with status 401 Unauthorized, it&#x27;s
usually because:</p><p>a) the client TLS certificate has not been correctly installed, in which case
you just need to install the eopeer package (and restart nginx)</p><p>b) the client TLS certificate has correctly been installed, but it hasn&#x27;t been
applied because you forgot to restart nginx with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ service nginx restart</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If on the other hand the requests are reaching to nginx but somehow are not
being processed, this is usually because previously an error happened during the
processing of an action of an election and the processing of the action was
never marked to a finished state, and election-orchestra is configured to
execute only one task at once. There&#x27;s an easy way to solve this isssue; just
restart election-orchestra:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ supervisorctl restart eorchestra</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li><p>You should also take a look at election-orchestra log:</p><p>$ sudo supervisorctl tail -f eorchestra</p></li></ol><p>election-orchestra is the software that organizes the creation of the keys
and the tallying of the election inside election authority servers,
communicating with other authorities and the agora servers.</p><p>You might find this kind of error in the eorchestra log:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ConnectionError: HTTPConnectionPool(host=&#x27;agora&#x27;, port=14443): Max retries exceeded with url: /api/election/103/keydone (Caused by &lt;class &#x27;socket.error&#x27;&gt;: [Errno 110] Connection timed out)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This happens when election keys have been created, but the last step, which is
to send the public keys to the requester agora server, has failed. This might
have happened because the agora TLS certificate is correctly installed (with
the peer package), but the ip address in the peer package was invalid, for
example because the communication with the agora server should be through its
private ip-address and it&#x27;s been configured to be done through its public ip, or
viceversa. If it&#x27;s the former, what you&#x27;d do is:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># generate the correct agora peer package, with the private ip address</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agoraServer $ sudo eopeers --show-mine --private &gt; agora.pkg</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># copy the agora peer package to the election authorities</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">scp blah blah</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># uninstall the old agora peer package, install the new one and reinstall</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo eopeers --uninstall agora</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo eopeers --install agora.pkg &amp;&amp; sudo service nginx restart</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>An alternative way of correcting the ip-address issue is to just add another
alias directly in /etc/hosts. This can be done in the deployment config.yml file
in the &quot;config.hosts&quot; variable.</p><ol start="3"><li><p>Take a look at agora-elections log:</p><p>$ sudo supervisorctl tail -f agora-elections</p></li></ol><p>agora-elections is the application run in agora web servers that is in charge of
collecting cast ballots (the electronic ballot box) and also connecting with
election authorities to trigger the creation of election keys and launching
the tally.</p><p>When you launch an election, it might inmmediatly fail if the agora web server
doesn&#x27;t have the election eopeer packages correctly installed. Please check
that:</p><p>a) The authority packages are installed with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo eopeers --list</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>b) The authority packages are installed with the correct ip-addresses. Bear in
mind that they might be installed with the public-ip address and maybe they
should be installed with the public ip address or viceversa. You can see a peer
package installed ip-address with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo eopeers --list &lt;NAME&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>c) check that the director authority peer package, which is the authority that
orchestrates the communication with other authorities, has been installed with
the eopeers &quot;--keystore /home/agoraelections/keystore.jks&quot; parameter. This is
needed because the TLS certificate of this authority needs to be accessible not
only to nginx but also directly to agora-elections.</p><p>Also, if you ever need to uninstall the peer package of this election authority,
remember to do --uninstall with the
&quot;--keystore /home/agoraelections/keystore.jks&quot; parameter.</p><p>d) Check that you have restarted both nginx and agora-elections if you have
changed any peer package:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo supevisorctl restart agora-elections &amp;&amp; sudo service nginx restart</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>e) Check that the list of election authorities are correctly configured in
agora-elections in the file
/home/agoraelections/agora-elections/conf/application.local.conf. This is
/configured during deployment in the &quot;config.authorities&quot;, &quot;config.director&quot; and
&quot;config.auths&quot; variables in &quot;config.yml&quot;.</p><ol start="4"><li>Bear in mind that if you are using a production environment deployment, you
will have two or more front-end web servers with agora-elections. This means
that any of these servers might connect with the election authorities. The
configuration of the election authorities in that case is that one of them is
deemed to be the master agora server, and even though any of those agora servers
(with different private ip addresses) might be the initiator of a request to
the director election authority, the callback url will always point to the
same master agora server ip address. Also, note that the TLS certificate of
all the agora servers will be the same.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-election-tally-never-succeeds"></a>The election tally never succeeds<a class="hash-link" href="#the-election-tally-never-succeeds" title="Direct link to heading">#</a></h2><p>a) If the election public keys are correctly created, this means that the
connection between election authorities and the agora servers are usually all
ok; except for a couple things:</p><p>This usually happens when an election authority that is not the director
election authority hasn&#x27;t got correctly configured the ip address or TLS
certificate of the agora server, and thus it has failed to download the list of
ballots from that server. This can be checked looking at the &quot;eorchestra&quot; log
in that election authority:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo supervisorctl tail -f eorchestra</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Or taking a look at nginx log in the agora server, in which the request would
not reach because it&#x27;s going to another ip address:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo tail -f /var/log/nginx/access.log</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that this issue can also happen if in the agora server&#x27;s nginx log the
request is logged (and thus the server is being reached) but with status
401 Unauthorized because the agora web server hasn&#x27;t got properly configured
the TLS certificate of that election authority. The TLS certificate is included
in the peer package of the election authority.</p><p>To solve peer packages problems, see section 1.</p><p>b) If there is an error during the tally of plaintexts of the ballots (i.e.
after the anonymization and decryption step done by the election authorities).</p><p>In some rare cases, if there&#x27;s an issue in agora-results configuration or a bug
in agora-results or agora-tally, this might happen. To detect this issue, take
a look at the log in agora-elections when receiving the plaintexts of the
ballots when calculating the tally:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ sudo supervisorctl tail -f agora-elections</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="supervisor-is-not-running"></a>Supervisor is not running<a class="hash-link" href="#supervisor-is-not-running" title="Direct link to heading">#</a></h2><p>If the login page (/admin/login) loads but the form doesn&#x27;t show up, and when
you analyze traffic some queries (for example  https://agora/authapi/api/auth-event/1/) return
&quot;502 Bad Gateway&quot;, this might be because supervisor is dead. This is a bug
that we don&#x27;t know how to fix yet but has a simple solution: restart supervisor:</p><p>You can check that supervisor is down when this happens:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo supervisorctl status&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unix:///var/run/supervisor.sock no such file</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Connection to 127.0.0.1 closed.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If that&#x27;s the case, restart it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo /etc/init.d/supervisor* restart&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Afterwards, supervisor status should return something like this, which is ok:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo supervisorctl status&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    agora-elections                  RUNNING    pid 7665, uptime 0:00:04</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authapi                          RUNNING    pid 7663, uptime 0:00:04</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    authapi_celery                   RUNNING    pid 7667, uptime 0:00:04</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sentry                           RUNNING    pid 7664, uptime 0:00:04</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sentry_celery                    RUNNING    pid 7666, uptime 0:00:04</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Connection to 127.0.0.1 closed.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="problems-provisioning"></a>Problems provisioning<a class="hash-link" href="#problems-provisioning" title="Direct link to heading">#</a></h2><p>Sometimes the provisioning fails. This can be related to some syntax changes on
ansible&#x27;s playbooks format. Check that you have Ansible 2.x or superior. If you
are using vagrant to provision a virtual machine, you need to install ansible 2.x
on the host machine, not on the guest.</p><p>On Ubuntu, you can install the latest version of Ansible by executing:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get install software-properties-common pwgen -y</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-add-repository ppa:ansible/ansible -y</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get update</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get install ansible -y</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="issues-deploying-high-availability--load-balancer"></a>Issues deploying High Availability / Load Balancer<a class="hash-link" href="#issues-deploying-high-availability--load-balancer" title="Direct link to heading">#</a></h2><p>If you encounter the following issue when deploying:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fatal: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">: FAILED</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;changed&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> true, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cmd&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/lib/postgresql/9.4/bin/repmgr -f /etc/repmgr/repmgr.conf master register&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;delta&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:00:00.009032&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;end&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-12-30 10:16:05.318695&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;failed_when_result&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> true, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;msg&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;non-zero return code&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rc&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;start&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-12-30 10:16:05.309663&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stderr&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[2020-12-30 10:16:05] [ERROR] connection to database failed: fe_sendauth: no password supplied&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stderr_lines&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[2020-12-30 10:16:05] [ERROR] connection to database failed: fe_sendauth: no password supplied&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stdout&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stdout_lines&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It&#x27;s usually related to a misconfiguration of the <code>/etc/hosts</code> file. Please
verify that when you execute within the deployed machine <code>ping &lt;machine-name&gt;</code>
it should be answering with the private ip address you configured in
<code>config.private_ipaddress</code>. Edit <code>/etc/hosts</code> to fix that if it is not.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="correctly-recreating-the-tls-certificate"></a>Correctly recreating the TLS certificate<a class="hash-link" href="#correctly-recreating-the-tls-certificate" title="Direct link to heading">#</a></h2><p>Sometimes a misconfiguration of the <code>config.hostname</code> or
<code>config.agora_elections.domain</code> deployment variables happen. For example, you
might have used the wrong DNS or hostname by error, or maybe you need to change
it to their new value(s). </p><p>Here we will document what needs to be done depending on the type of machine
that is affected if this happens. </p><p>Please review the <a href="/admin-manual/docs/deployment/guide#connecting-authorities">Connecting Authorities section</a>
of the <a href="/admin-manual/docs/deployment/guide">deployment guide</a> to understand the general procedures when connecting
the authorities and the agora servers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="for-an-election-authority"></a>For an election authority<a class="hash-link" href="#for-an-election-authority" title="Direct link to heading">#</a></h3><p>You need to set the <code>config.yml</code> variables (<code>config.hostname</code> and/or
<code>config.agora_elections.domain</code>) to their new value.</p><p>You also need to set the <code>config.cert.force_create</code> to <code>&#x27;true&#x27;</code> and re-deploy.
This will force regeneration of the TLS self-signed certificate of the machine.
After redeploying, it&#x27;s <strong>important</strong> to set back <code>config.cert.force_create</code> to
the default value (<code>&#x27;false&#x27;</code>). Otherwise, in future redeployments you might
forget about this setting but still re-generate the TLS self-signed certificate,
and thus other machines will stop working with the redeployed machine because
they won&#x27;t have this new certificate installed.</p><p>After redeploying the affected machine, you just need to uninstall the old
certificate in the connected peers and install the new one. Let&#x27;s say that in
our example we have a deployment with three machines, <code>focal-s1</code>, <code>focal-a1</code> and
<code>focal-a2</code> and we are changing the hostname of the election authority <code>focal-a2</code>
to <code>focal-a3</code>.</p><p>These would be the steps:</p><ol><li>Obtain the new eopeer package executing <code>sudo eopeers --show-mine</code> (or
<code>sudo eopeers --show-mine --private-ip</code> if it&#x27;s going to be used in a local
network). Write that certificate in a file called <code>focal-a3.pkg</code> that we will
use later, both in <code>focal-s1</code> and <code>focal-a1</code>.</li><li>Uninstall the previous eopeer package for <code>focal-a2</code> in <code>focal-s1</code> and
<code>focal-a1</code> executing <code>sudo eopeers --uninstall focal-a2</code>. Note that if the
election authority being uninstalled is the master authority in the agora server
and was installed using <code>--keystore /home/agoraelections/keystore.jks</code>, then the
uninstall in <code>focal-s1</code> also needs to have that parameter to remove the
certificate also from there. In that case, the command to execute would be
<code>eopeers --uninstall focal-a2 --keystore /home/agoraelections/keystore.jks</code>.</li><li>Install the new eopeer package in for <code>focal-a3</code> in <code>focal-s1</code> and
<code>focal-a1</code> executing <code>sudo eopeers --install focal-a3.pkg</code>. Again, if this
authority is to be the master authority in the agora server, then append
<code>--keystore /home/agoraelections/keystore.jks</code> to that command when being
executed in <code>focal-s1</code>.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="for-an-agora-server"></a>For an agora server<a class="hash-link" href="#for-an-agora-server" title="Direct link to heading">#</a></h3><p>The process with an agora server is similar but a bit more nuanced because the
certificate lies in multiple places. Before redeploying, you need to uninstall
all the eopeers installed in the server using <code>eopeers --list</code> and
<code>eopeers --uninstall &lt;hostname&gt; [&lt;hostname&gt; ..]</code>.</p><p>Then, you need to remove the files <code>/home/agoraelections/keystore.jks</code> and
<code>/home/agoraelections/certs.p12</code>. Afterwards, you can follow the instructions
in the previous section to redeploy and redistribute the certificate to the
peers. Finally, you need to re-install the certificates of the peers in the
agora server again.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/agoravoting/admin-manual/edit/master/docs/deployment/troubleshooting.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/admin-manual/docs/deployment/guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deployment Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/admin-manual/docs/deployment/browsers-and-cookies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Browsers and Cookies »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problems-when-creating-the-election" class="table-of-contents__link">Problems when creating the election</a></li><li><a href="#the-election-tally-never-succeeds" class="table-of-contents__link">The election tally never succeeds</a></li><li><a href="#supervisor-is-not-running" class="table-of-contents__link">Supervisor is not running</a></li><li><a href="#problems-provisioning" class="table-of-contents__link">Problems provisioning</a></li><li><a href="#issues-deploying-high-availability--load-balancer" class="table-of-contents__link">Issues deploying High Availability / Load Balancer</a></li><li><a href="#correctly-recreating-the-tls-certificate" class="table-of-contents__link">Correctly recreating the TLS certificate</a><ul><li><a href="#for-an-election-authority" class="table-of-contents__link">For an election authority</a></li><li><a href="#for-an-agora-server" class="table-of-contents__link">For an agora server</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/deployment/guide">Deployment</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/translation/guide">Translation</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/testing/bulk">Election Testing</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/advanced-elections/introduction">Advanced Elections</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/contribute/guide">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/agoravoting" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/BSqF8Cbr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/nvotes_com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://nvotes.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/agoravoting/admin-manual" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 nVotes</div></div></div></footer></div>
<script src="/admin-manual/assets/js/runtime~main.50757806.js"></script>
<script src="/admin-manual/assets/js/main.56a78266.js"></script>
</body>
</html>