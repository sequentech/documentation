<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/admin-manual/blog/rss.xml" title="admin-manual Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/admin-manual/blog/atom.xml" title="admin-manual Blog Atom Feed"><title data-react-helmet="true">Deployment Troubleshooting | admin-manual</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deployment Troubleshooting | admin-manual"><meta data-react-helmet="true" name="description" content="1. Problems when creating the election"><meta data-react-helmet="true" property="og:description" content="1. Problems when creating the election"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting"><link data-react-helmet="true" rel="shortcut icon" href="/admin-manual/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/admin-manual/docs/deployment/troubleshooting"><link rel="stylesheet" href="/admin-manual/styles.21f0090d.css">
<link rel="preload" href="/admin-manual/styles.19eaad5a.js" as="script">
<link rel="preload" href="/admin-manual/runtime~main.c5dd56a7.js" as="script">
<link rel="preload" href="/admin-manual/main.2dbf7e43.js" as="script">
<link rel="preload" href="/admin-manual/1.903765d1.js" as="script">
<link rel="preload" href="/admin-manual/2.c1de2e42.js" as="script">
<link rel="preload" href="/admin-manual/16.c4d297e4.js" as="script">
<link rel="preload" href="/admin-manual/17.c6f94847.js" as="script">
<link rel="preload" href="/admin-manual/935f2afb.1fa3281e.js" as="script">
<link rel="preload" href="/admin-manual/17896441.fac450d2.js" as="script">
<link rel="preload" href="/admin-manual/c2edb613.8bafe174.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/admin-manual/"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Admin Manual</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/admin-manual/docs/deployment/guide">Docs</a><a href="https://nvotes.com/blog/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/agoravoting/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://nvotes.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Powered By nVotes</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/admin-manual/"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/admin-manual/img/nvotes_logo.png" alt="nVotes" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Admin Manual</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/admin-manual/docs/deployment/guide">Docs</a></li><li class="menu__list-item"><a href="https://nvotes.com/blog/" target="_blank" rel="noopener noreferrer" class="menu__link">Blog</a></li><li class="menu__list-item"><a href="https://github.com/agoravoting/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://nvotes.com/" target="_blank" rel="noopener noreferrer" class="menu__link">Powered By nVotes</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/admin-manual/docs/deployment/guide">Deployment Guide</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/admin-manual/docs/deployment/troubleshooting">Deployment Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Translation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/translation/guide">Translation Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Election Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/testing/bulk">Bulk Election Testing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced Elections</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/advanced-elections/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/advanced-elections/election-creation">Election Creation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/advanced-elections/parent-and-children-elections">Parent &amp; Children Elections</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/admin-manual/docs/contribute/guide">Contribution Guide</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Deployment Troubleshooting</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-problems-when-creating-the-election"></a>1. Problems when creating the election<a class="hash-link" href="#1-problems-when-creating-the-election" title="Direct link to heading">#</a></h2><p>This is usually a problem with election authorities. Unfortunately, most of the
issues related to election authorities do not get reported to the user nor the
superadmins, although it&#x27;s also true that most of these issues are solved when
doing the deployment.</p><p>To debug and analyze the situation, you can use the following commands in the
election authorities or the agora server:</p><ol><li><p>See if the requests are reaching to nginx reading its log:</p><p>$ sudo tail -f /var/log/nginx/access.log</p></li></ol><p>nginx is in charge of filtering and accepting only https requests from http
clients (i.e. other &quot;eopeers&quot; or &quot;agora&quot; servers) whose client tls certificate
is installed in the peer.</p><p>If requests are being received but rejected with status 401 Unauthorized, it&#x27;s
usually because:</p><p>a) the client TLS certificate has not been correctly installed, in which case
you just need to install the eopeer package (and restart nginx)</p><p>b) the client TLS certificate has correctly been installed, but it hasn&#x27;t been
applied because you forgot to restart nginx with:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ service nginx restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If on the other hand the requests are reaching to nginx but somehow are not
being processed, this is usually because previously an error happened during the
processing of an action of an election and the processing of the action was
never marked to a finished state, and election-orchestra is configured to
execute only one task at once. There&#x27;s an easy way to solve this isssue; just
restart election-orchestra:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ supervisorctl restart eorchestra</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li><p>You should also take a look at election-orchestra log:</p><p>$ sudo supervisorctl tail -f eorchestra</p></li></ol><p>election-orchestra is the software that organizes the creation of the keys
and the tallying of the election inside election authority servers,
communicating with other authorities and the agora servers.</p><p>You might find this kind of error in the eorchestra log:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ConnectionError: HTTPConnectionPool(host=&#x27;agora&#x27;, port=14443): Max retries exceeded with url: /api/election/103/keydone (Caused by &lt;class &#x27;socket.error&#x27;&gt;: [Errno 110] Connection timed out)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This happens when election keys have been created, but the last step, which is
to send the public keys to the requester agora server, has failed. This might
have happened because the agora TLS certificate is correctly installed (with
the peer package), but the ip address in the peer package was invalid, for
example because the communication with the agora server should be through its
private ip-address and it&#x27;s been configured to be done through its public ip, or
viceversa. If it&#x27;s the former, what you&#x27;d do is:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># generate the correct agora peer package, with the private ip address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">agoraServer $ sudo eopeers --show-mine --private &gt; agora.pkg</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># copy the agora peer package to the election authorities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">scp blah blah</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># uninstall the old agora peer package, install the new one and reinstall</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo eopeers --uninstall agora</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo eopeers --install agora.pkg &amp;&amp; sudo service nginx restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>An alternative way of correcting the ip-address issue is to just add another
alias directly in /etc/hosts. This can be done in the deployment config.yml file
in the &quot;config.hosts&quot; variable.</p><ol start="3"><li><p>Take a look at agora-elections log:</p><p>$ sudo supervisorctl tail -f agora-elections</p></li></ol><p>agora-elections is the application run in agora web servers that is in charge of
collecting cast ballots (the electronic ballot box) and also connecting with
election authorities to trigger the creation of election keys and launching
the tally.</p><p>When you launch an election, it might inmmediatly fail if the agora web server
doesn&#x27;t have the election eopeer packages correctly installed. Please check
that:</p><p>a) The authority packages are installed with:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo eopeers --list</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>b) The authority packages are installed with the correct ip-addresses. Bear in
mind that they might be installed with the public-ip address and maybe they
should be installed with the public ip address or viceversa. You can see a peer
package installed ip-address with:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo eopeers --list &lt;NAME&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>c) check that the director authority peer package, which is the authority that
orchestrates the communication with other authorities, has been installed with
the eopeers &quot;--keystore /home/agoraelections/keystore.jks&quot; parameter. This is
needed because the TLS certificate of this authority needs to be accessible not
only to nginx but also directly to agora-elections.</p><p>Also, if you ever need to uninstall the peer package of this election authority,
remember to do --uninstall with the
&quot;--keystore /home/agoraelections/keystore.jks&quot; parameter.</p><p>d) Check that you have restarted both nginx and agora-elections if you have
changed any peer package:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo supevisorctl restart agora-elections &amp;&amp; sudo service nginx restart</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>e) Check that the list of election authorities are correctly configured in
agora-elections in the file
/home/agoraelections/agora-elections/conf/application.local.conf. This is
/configured during deployment in the &quot;config.authorities&quot;, &quot;config.director&quot; and
&quot;config.auths&quot; variables in &quot;config.yml&quot;.</p><ol start="4"><li>Bear in mind that if you are using a production environment deployment, you
will have two or more front-end web servers with agora-elections. This means
that any of these servers might connect with the election authorities. The
configuration of the election authorities in that case is that one of them is
deemed to be the master agora server, and even though any of those agora servers
(with different private ip addresses) might be the initiator of a request to
the director election authority, the callback url will always point to the
same master agora server ip address. Also, note that the TLS certificate of
all the agora servers will be the same.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-the-election-tally-never-succeeds"></a>2. The election tally never succeeds<a class="hash-link" href="#2-the-election-tally-never-succeeds" title="Direct link to heading">#</a></h2><p>a) If the election public keys are correctly created, this means that the
connection between election authorities and the agora servers are usually all
ok; except for a couple things:</p><p>This usually happens when an election authority that is not the director
election authority hasn&#x27;t got correctly configured the ip address or TLS
certificate of the agora server, and thus it has failed to download the list of
ballots from that server. This can be checked looking at the &quot;eorchestra&quot; log
in that election authority:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">authX $ sudo supervisorctl tail -f eorchestra</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Or taking a look at nginx log in the agora server, in which the request would
not reach because it&#x27;s going to another ip address:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo tail -f /var/log/nginx/access.log</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that this issue can also happen if in the agora server&#x27;s nginx log the
request is logged (and thus the server is being reached) but with status
401 Unauthorized because the agora web server hasn&#x27;t got properly configured
the TLS certificate of that election authority. The TLS certificate is included
in the peer package of the election authority.</p><p>To solve peer packages problems, see section 1.</p><p>b) If there is an error during the tally of plaintexts of the ballots (i.e.
after the anonymization and decryption step done by the election authorities).</p><p>In some rare cases, if there&#x27;s an issue in agora-results configuration or a bug
in agora-results or agora-tally, this might happen. To detect this issue, take
a look at the log in agora-elections when receiving the plaintexts of the
ballots when calculating the tally:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ sudo supervisorctl tail -f agora-elections</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-supervisor-is-not-running"></a>3. Supervisor is not running<a class="hash-link" href="#3-supervisor-is-not-running" title="Direct link to heading">#</a></h2><p>If the login page (/admin/login) loads but the form doesn&#x27;t show up, and when
you analyze traffic some queries (for example  https://agora/authapi/api/auth-event/1/) return
&quot;502 Bad Gateway&quot;, this might be because supervisor is dead. This is a bug
that we don&#x27;t know how to fix yet but has a simple solution: restart supervisor:</p><p>You can check that supervisor is down when this happens:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo supervisorctl status&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unix:///var/run/supervisor.sock no such file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Connection to 127.0.0.1 closed.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If that&#x27;s the case, restart it:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo /etc/init.d/supervisor* restart&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Afterwards, supervisor status should return something like this, which is ok:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd agora</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">agora $ vagrant ssh -c &quot;sudo supervisorctl status&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    agora-elections                  RUNNING    pid 7665, uptime 0:00:04</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authapi                          RUNNING    pid 7663, uptime 0:00:04</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authapi_celery                   RUNNING    pid 7667, uptime 0:00:04</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sentry                           RUNNING    pid 7664, uptime 0:00:04</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sentry_celery                    RUNNING    pid 7666, uptime 0:00:04</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Connection to 127.0.0.1 closed.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-problems-provisioning"></a>4. Problems provisioning<a class="hash-link" href="#4-problems-provisioning" title="Direct link to heading">#</a></h2><p>Sometimes the provisioning fails. This can be related to some syntax changes on
ansible&#x27;s playbooks format. Check that you have Ansible 2.x or superior. If you
are using vagrant to provision a virtual machine, you need to install ansible 2.x
on the host machine, not on the guest.</p><p>On Ubuntu, you can install the latest version of Ansible by executing:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get install software-properties-common pwgen -y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-add-repository ppa:ansible/ansible -y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo apt-get install ansible -y</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="5-issues-deploying-high-availability--load-balancer"></a>5. Issues deploying High Availability / Load Balancer<a class="hash-link" href="#5-issues-deploying-high-availability--load-balancer" title="Direct link to heading">#</a></h2><p>If you encounter the following issue when deploying:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fatal: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">localhost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">: FAILED</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;changed&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> true, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cmd&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/lib/postgresql/9.4/bin/repmgr -f /etc/repmgr/repmgr.conf master register&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;delta&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0:00:00.009032&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;end&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-12-30 10:16:05.318695&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;failed_when_result&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> true, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;msg&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;non-zero return code&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rc&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;start&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2020-12-30 10:16:05.309663&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stderr&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[2020-12-30 10:16:05] [ERROR] connection to database failed: fe_sendauth: no password supplied&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stderr_lines&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[2020-12-30 10:16:05] [ERROR] connection to database failed: fe_sendauth: no password supplied&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stdout&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;stdout_lines&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It&#x27;s usually related to a misconfiguration of the <code>/etc/hosts</code> file. Please
verify that when you execute within the deployed machine <code>ping &lt;machine-name&gt;</code>
it should be answering with the private ip address you configured in
<code>config.private_ipaddress</code>. Edit <code>/etc/hosts</code> to fix that if it is not.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/agoravoting/admin-manual/edit/master/docs/deployment/troubleshooting.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/admin-manual/docs/deployment/guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deployment Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/admin-manual/docs/translation/guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Translation Guide »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-problems-when-creating-the-election" class="table-of-contents__link">1. Problems when creating the election</a></li><li><a href="#2-the-election-tally-never-succeeds" class="table-of-contents__link">2. The election tally never succeeds</a></li><li><a href="#3-supervisor-is-not-running" class="table-of-contents__link">3. Supervisor is not running</a></li><li><a href="#4-problems-provisioning" class="table-of-contents__link">4. Problems provisioning</a></li><li><a href="#5-issues-deploying-high-availability--load-balancer" class="table-of-contents__link">5. Issues deploying High Availability / Load Balancer</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/deployment/guide">Deployment</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/translation/guide">Translation</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/testing/bulk">Election Testing</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/advanced-elections/introduction">Advanced Elections</a></li><li class="footer__item"><a class="footer__link-item" href="/admin-manual/docs/contribute/guide">Contribute</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/agoravoting" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://discord.gg/BSqF8Cbr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/nvotes_com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://nvotes.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/agoravoting/admin-manual" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 nVotes</div></div></div></footer></div>
<script src="/admin-manual/styles.19eaad5a.js"></script>
<script src="/admin-manual/runtime~main.c5dd56a7.js"></script>
<script src="/admin-manual/main.2dbf7e43.js"></script>
<script src="/admin-manual/1.903765d1.js"></script>
<script src="/admin-manual/2.c1de2e42.js"></script>
<script src="/admin-manual/16.c4d297e4.js"></script>
<script src="/admin-manual/17.c6f94847.js"></script>
<script src="/admin-manual/935f2afb.1fa3281e.js"></script>
<script src="/admin-manual/17896441.fac450d2.js"></script>
<script src="/admin-manual/c2edb613.8bafe174.js"></script>
</body>
</html>